{
    runCommand: {
               aggregate : 'patientorders',
               pipeline : [
                               { 
                               $match: { statusflag: 'A',  _id : {"$oid":$P{searchcriteria} }}
                               },
        { $unwind: { path: "$patientorderitems", preserveNullAndEmptyArrays: true } },
        { $match: {"patientorderitems.isactive":true  }},
        { $lookup: { from: 'departments', localField: 'orderdepartmentuid', foreignField: '_id', as: 'orderdepartmentdetails' } },
       { $unwind: { path: '$orderdepartmentdetails', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'departments', localField: 'ordertodepartmentuid', foreignField: '_id', as: 'ordertodepartmentdetails' } },
       { $unwind: { path: '$ordertodepartmentdetails', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'users', localField: 'patientorderitems.careprovideruid', foreignField: '_id', as: 'careproviderdetails' } },
       { $unwind: { path: '$careproviderdetails', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField: 'ordermodeuid', foreignField: '_id', as: 'ordermode' } },
       { $unwind: { path: '$ordermode', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField: 'ordercommuid', foreignField: '_id', as: 'ordercommunication' } },
       { $unwind: { path: '$ordercommunication', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField: 'ordertypeuid', foreignField: '_id', as: 'ordertype' } },
       { $unwind: { path: '$ordertype', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField: 'orderpriorityuid', foreignField: '_id', as: 'orderpriority' } },
       { $unwind: { path: '$orderpriority', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'departments', localField: 'userdepartmentuid', foreignField: '_id', as: 'userdepartment' } },
       { $unwind: { path: '$userdepartment', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'users', localField: 'orderinguseruid', foreignField: '_id', as: 'orderinguser' } },
       { $unwind: { path: '$orderinguser', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'inventorystores', localField: 'inventorystoreuid', foreignField: '_id', as: 'store' } },
       { $unwind: { path: '$store', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'orderitems', localField: 'patientorderitems.orderitemuid', foreignField: '_id', as: 'orderitem' } },
       { $unwind: { path: '$orderitem', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'ordercategories', localField: 'orderitem.ordercatuid', foreignField: '_id', as: 'orderitemcat' } },
       { $unwind: { path: '$orderitemcat', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'ordercategories', localField: 'orderitem.ordersubcatuid', foreignField: '_id', as: 'orderitemsubcat' } },
       { $unwind: { path: '$orderitemsubcat', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField: 'patientorderitems.statusuid', foreignField: '_id', as: 'orderitemstatus' } },
       { $unwind: { path: '$orderitemstatus', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.instructionuid", foreignField: "_id", as: "instructions" } },
       { $unwind: { path: '$instructions', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "frequencies", localField: "patientorderitems.frequencyuid", foreignField: "_id", as: "frequency" } },
       { $unwind: { path: "$frequency", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.quantityUOM", foreignField: "_id", as: "quantityUOM" } },
       { $unwind: { path: "$quantityUOM", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.routeuid", foreignField: "_id", as: "route" } },
       { $unwind: { path: "$route", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.formuid", foreignField: "_id", as: "form" } },
       { $unwind: { path: "$form", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.dosageUOM", foreignField: "_id", as: "dosageUOM" } },
       { $unwind: { path: "$dosageUOM", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.infusionrateuom", foreignField: "_id", as: "infusionrateUOM" } },
       { $unwind: { path: "$infusionrateUOM", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: "referencevalues", localField: "patientorderitems.infusiondurationuom", foreignField: "_id", as: "infusiondurationuom" } },
       { $unwind: { path: "$infusiondurationuom", preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'patients', localField: 'patientuid', foreignField: '_id', as: 'patientdetails' } },
       { $unwind: { path: '$patientdetails', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'patientvisits', localField: 'patientvisituid', foreignField: '_id', as: 'patientvisitdetails' } },
       { $unwind: { path: '$patientvisitdetails', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'drugmasters', localField: 'patientorderitems.drugmasteruid', foreignField: '_id', as: 'drugdetails' } },
       { $unwind: { path: '$drugdetails', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField: 'careproviderdetails.titleuid', foreignField: '_id', as: 'careprovidertitle' } },
       { $unwind: { path: '$careprovidertitle', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'wards', localField: 'warduid', foreignField: '_id', as: 'ward' } },
       { $unwind: { path: '$ward', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'beds', localField: 'beduid', foreignField: '_id', as: 'bed' } },
       { $unwind: { path: '$bed', preserveNullAndEmptyArrays: true } },
       { $lookup: { from: 'referencevalues', localField:'patientdetails.titleuid', foreignField: '_id', as: 'patienttitle' } },
       { $unwind: { path: '$patienttitle', preserveNullAndEmptyArrays: true } },
       {
                $project: {
               "_id": "$patientorderitems._id",
               "orderdate": "$orderdate",
               "orderdepartment": "$orderdepartmentdetails.name",
               "orderdepartmentcode": "$orderdepartmentdetails.code",
               "ordertodepartment": "$ordertodepartmentdetails.name",
               "ordertodepartmentcode": "$ordertodepartmentdetails.code",
               "careprovidername": "$careproviderdetails.name",
               "careprovidercode": "$careproviderdetails.code",
               "ordercattype": "$ordercattype",
               "ordermodedescription": "$ordermode.valuedescription",
               "ordermodecode": "$ordermode.valuecode",
               "ordercommunication": "$ordercommunication.valuedescription",
               "ordercommunicationcode": "$ordercommunication.valuecode",
               "ordertype": "$ordertype.valuedescription",
               "ordertypecode": "$ordertype.valuecode",
               "ordernumber": "$ordernumber",
               "orderpriority": "$orderpriority.valuedescription",
               "orderprioritycode": "$orderpriority.valuecode",
               "userdepartment": "$userdepartment.name",
               "userdepartmentcode": "$userdepartment.code",
               "orderingusername": "$orderinguser.name",
               "orderingusercode": "$orderinguser.code",
               "isautogenerated": "$isautogenerated",
               "storecode": "$store.code",
               "storename": "$store.name",
               "patientorderuid": "$_id",
               "itemname": "$orderitem.name",
               "itemcode": "$orderitem.code",
               "orderitemcatname": "$orderitemcat.name",
               "orderitemsubcatname": "$orderitemsubcat.name",
               "itemcode": "$orderitem.code",
               "startdate": "$patientorderitems.startdate",
               "enddate": "$patientorderitems.enddate",
               "orderitemstatus": "$orderitemstatus.valuedescription",
               "orderitemstatuscode": "$orderitemstatus.valuecode",
               "isactive": "$patientorderitems.isactive",
               "instructions": "$instructions.valuedescription",
               "frequency": "$frequency.description",
               "frequencylocallang": "$frequency.locallangdesc",
               "frequencytype": "$frequency.type",
               "quantity": "$patientorderitems.quantity",
               "quantityUOM": "$quantityUOM.valuedescription",
               "quantityUOMCode": "$quantityUOM.valuecode",
               "route": "$route.valuedescription",
               "routecode": "$route.valuecode",
               "form": "$form.valuedescription",
               "formcode": "$form.valuecode",
               "dosage": "$patientorderitems.dosage",
               "dosageUOM": "$dosageUOM.valuedescription",
               "dosageUOMCode": "$dosageUOM.valuecode",
               "duration": "$patientorderitems.duration",
               "orderitemcomments": "$patientorderitems.comments",
               "broughtfromoutside": "$patientorderitems.broughtfromoutside",
               "infusionrate": "$patientorderitems.infusionrate",
               "infusionduration": "$patientorderitems.infusionduration",
               "infusionrateUOM": "$infusionrateUOM.valuedescription",
               "infusiondurationuom": "$infusiondurationuom.valudescription",
               "iscontinuousorder": "$patientorderitems.iscontinuousorder",
               "ishourlycharge": "$patientorderitems.ishourlycharge",
               "isapprovalrequired": "$patientorderitems.isapprovalrequired",
               "iscosignrequired": "$patientorderitems.iscosignrequired",
               "unitprice": "$patientorderitems.unitprice",
               "payordiscount": "$patientorderitems.payordiscount",
               "specialdiscount": "$patientorderitems.specialdiscount",
               "totalprice": "$patientorderitems.totalprice",
               "ispriceoverwritten": "$patientorderitems.ispriceoverwritten",
               "assignquantity": "$patientorderitems.assignquantity",
               "orguid": "$orguid",
               "refillnumber": "$patientorderitems.refillnumber",
               "refillorderuid": "$patientorderitems.refillorderuid",
               "patientuid": "$patientdetails._id",
               "patientvisituid": "$patientvisitdetails._id",
               "admininstruction": "$patientorderitems.administrationinstruction",
               "routelocallang": "$route.locallanguagedesc",
               "dosageUOMlocal": "$dosageUOM.locallanguagedesc",
               "quantityUOMlocal": "$quantityUOM.locallanguagedesc",
               "dosagenotapplicabe": "$drugdetails.dosagenotapplicable",
               "indication": "$orderitem.orderiteminstructions",
               "careproviderlastname": "$careproviderdetails.lastname",
               "careprovidertitle": "$careprovidertitle.valuedescription",
               "careprovidertitlelocal": "$careprovidertitle.locallanguagedesc",
               "statusflag": "$patientorderitems.statusflag",
               "wardname": "$ward.name",
               "wardcode": "$ward.code",
               "bedname": "$bed.name",
               "patientfirstname":"$patientdetails.firstname",
               "patientmiddlename":"$patientdetails.middlename",
               "patientlastname":"$patientdetails.lastname",
               "patientmrn" :"$patientdetails.mrn",
               "patientvisitid" :"$patientvisitdetails.visitid",
               "patienttitle" :"$patienttitle.valuedescription",
               "careprovidernameenglish":"$careproviderdetails.printname",
               "indicationeng": { $arrayElemAt: [ "$orderitem.orderiteminstructions.instructiontext", -1 ] },
           }
       }]
       }
   }